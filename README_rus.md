# Рабочий telegram-бот 
## Описание программы
## 1. Описание
### 1.1. Файловая структура, описание основных функций
Программа написана на языке Python 3.
В программе используются нестандартные модули:
* openpyxl;
* telepot.

Данный бот производит анализ двух таблиц excel. Бот определяет, какие задачи 
были выполнены ТОЛЬКО ЗА СЕГОДНЯШНИЙ ДЕНЬ и выводит список этих задач в ответном сообщении.

Программа состоит из 5 файлов:
* constants.py – файл, в котором хранятся константы (токен и путь к папке с таблицами);
* download.py – скрипт, который выполняет скачивание таблиц Google Sheet;
* excelFileParser.py – файл, содержащий класс excelFileParser, который выполняет анализ 
таблицы excel и находит выполненные задачи;
* telegrambot.py – файл, содержащий класс TelegramBot. Этот класс описывает поведение
бота telegram;
* maincode.py – файл, содержащий функцию main. Функция main это главный код, который
открывает таблицы excel, создает экземпляр класса excelFileParser, с помощью методов
класса excelFileParser производит анализ этих таблиц и возвращает словарь с выполненными
ТОЛЬКО ЗА СЕГОДНЯШНИЙ ДЕНЬ задачами.

## 2. Файл constants.py
### 2.1. Описание
Файл содержит константы:
* token – токен;
* folder_path – путь к папке, в которой находятся таблицы Old.xlsx и New.xlsx.

## 3. Файл download.py
### 3.1. Описание
Код, который выполняет регулярное обновление (раз в 30 минут) сегодняшней рабочей таблицы
(документ Google Sheet), а также выполняет обновление вчерашней таблицы в промежутке между
0 и 2 часами ночи текущего дня. Бесконечный цикл.

### 3.2. Функция download ( )
**Описание**

Скачивание файла по переданной в параметрах ссылке. Присваивание файлу переданного в параметрах имени.

**Параметры**

* (String) url – ссылка на скачивание файла;
* (String) file_name – имя, которое будет присвоено файлу после скачивания.

**Возвращаемые значения**

Не возвращает.

## 4. Файл excelFileParser.py
### 4.1. Описание
Файл, содержащий класс excelFileParser ( ).

### 4.2. Класс excelFileParser ( )
#### 4.2.1. Описание, структура класса
Класс, который занимается анализом и обработкой данных из файла .xlsx.
Класс содержит следующие методы:
* init (self)
* get_ready_task_dict (self, sheet)
* get_only_today_task_dict (self, today_task_dict, yesterday_task_dict)
* search_start_row (self, sheet_obj, row, column, textToFind)
* search_finish_row (self, sheet_obj, row, column)
* get_task_dict (self, sheet_obj, row1, row2, column, color)

#### 4.2.2. Метод __init__ ( )
**Описание**

Инициализация класса.

**Параметры**

Отсутствуют.

**Возвращаемые значения**

Отсутствуют.

#### 4.2.3. Метод get_ready_task_dict ( )
**Описание**

Метод, который вычисляет исходные данные и передаёт их в функцию get_task_dict ( ).
В конечном результате метод возвращает словарь с выполненными задачами,
где ключи – номера задач, значения – описания задач.

**Параметры**

(Worksheet) sheet – объект класса Worksheet (библиотека openpyxl).

**Возвращаемые значения**

(dict) result_dict – словарь выполнненых задач.

#### 4.2.4. Метод get_only_today_task_dict ( )
**Описание**

Метод, который принимает два словаря – выполненные задачи во вчерашней таблице,
и выполненные задачи в сегодняшней таблице. Потом он удаляет их сегодняшнего словаря все задачи,
входящие во вчерашний словарь. В итоге получаем словарь, в котором остались только те задачи,
которые выполнены ЗА СЕГОДНЯ.

**Параметры**

* (dict) today_task_dict – словарь с выполненными задачами. Словарь получен для сегодняшней таблицы excel;
* (dict) yesterday_task_dict – словарь с выполненными задачами. Словарь получен для вчерашней таблицы excel.

**Возвращаемые значения**

(dict) today_task_dict - словарь с выполненными ТОЛЬКО ЗА СЕГОДНЯ задачами.

#### 4.2.5. Метод search_start_row ( )
**Описание**

Метод ищет номер строки, в которой хранится первая задача. Поиск ведётся в 1 столбце с заданной строки.
Как только в ячейке находится символ “№” поиск останавливается.
Строка с первой задачей находится на 2 позиции ниже.

**Параметры**

* (Worksheet) sheet_obj – объект класса Worksheet (библиотека openpyxl);
* (int) row – номер строки, с которой будет начинаться поиск;
* (int) column – номер столбца, в котором производится поиск заданного символа;
* (string) text_to_find – символ для поиска.

**Возвращаемые значения**

(int) start_row – номер строки с первой задачей.

#### 4.2.6. Метод search_finish_row ( )
**Описание**

Метод ищет номер строки, в которой хранится последняя задача.

**Параметры**

* (Worksheet) sheet_obj – объект класса Worksheet (библиотека openpyxl);
* (int) row – номер строки, с которой будет начинаться поиск;
* (int) column – номер столбца, в котором производится поиск заданного символа.

**Возвращаемые значения**

(int) row – номер строки с последней задачей.

#### 4.2.7. Метод get_task_dict ( )
**Описание**

Метод, который составляет словарь задач для данного листа по переданным параметрам.
В частности, он ищет ячейки с заданным цветом (выполненные задачи отмечены этим цветом).

**Параметры**

* (Worksheet) sheet_obj – объект класса Worksheet (библиотека openpyxl);
* (int) start_row – номер строки, с которой будет начинаться поиск;
* (int) end_row – номер строки, до которой будет идти поиск;
* (int) column – номер столбца, в котором производится поиск заданного символа;
* (string) color – цвет, по которому ведётся поиск.

**Возвращаемые значения**

(dict) ready_task_dict - словарь с выполненными задачами.

## 5. Файл maincode.py
### 5.1. Описание
Файл, который занимается анализом и обработкой данных из файла .xlsx.

### 5.2. Функция maincode ( )
**Описание**

Функция создает полный абсолютный путь к каждой из таблиц.
Создаются объекты класса Workbook – вчерашнюю и сегодняшнюю таблицу.
Создаются объекты класса Worksheet – листы во вчерашней таблице и в сегодняшней.
Создаются экземпляр класса excelFileParser ( ).
Получают два словаря – словарь выполненных задач для вчерашней таблицы и для сегодняшней таблицы.
В итоге получает словарь выполненных задач ТОЛЬКО ЗА СЕГОДНЯ.

**Параметры**

* (string) partial_path – путь к папке, в которой находятся таблицы;
* (int) sheet_index – номер листа.

**Возвращаемые значения**

(dict) otrtd_dict (otrtd = only today ready task dict) – словарь с выполненными только
за сегодня задачами (для данного листа).

## 6. Файл telegrambot.py
### 6.1. Описание
Файл, содержащий класс TelegramBot ( ).

### 6.2. Класс TelegramBot ( )
#### 6.2.1. Описание, структура класса
Класс, который занимается анализом и обработкой данных из файла .xlsx.
Класс содержит следующие методы:
* init (self, token)
* main (self, message)
* start (self, chat_id)
* result_types (self, chat_id)
* sheet_dict (self)
* show_tasks (self, chat_id, tasks_dictionary)

#### 6.2.2. Метод __init__ ( )
**Описание**

Инициализация класса.

**Параметры**

(string) token.

**Возвращаемые значения**

Отсутствуют.

#### 6.2.3. Метод main ( )
**Описание**

В зависимости от запроса вызывает другие методы класса.

**Параметры**

(dict) message.

**Возвращаемые значения**

Отсутствуют.

#### 6.2.4. Метод start ( )
**Описание**

Метод, который вызывается при запуске бота, либо при неизвестной команде. Выводит список команд.

**Параметры**

(int) chat_id – id чата.

**Возвращаемые значения**

Отсутствуют.

#### 6.2.5. Метод result_types ( )
**Описание**

Выводит список команд.

**Параметры**

(int) chat_id – id чата.

**Возвращаемые значения**

Отсутствуют.

#### 6.2.6. Метод sheet_dict ( )
**Описание**

Формирует словарь, где ключи – команды (например, /sheet4),
значения – номера этих листов (для /sheet4 – 3).

**Параметры**

Отсутствуют.

**Возвращаемые значения**

(dict) command_dict – словарь команд, где ключи – названия команд, значения – номера листов.

#### 6.2.7. Метод show_tasks ( )
**Описание**

Выводит список выполненных задач. В конце выводит список команд.

**Параметры**

* (int) chat_id – id чата.
* (dict) tasks_dictionary – словарь со списком задач.

**Возвращаемые значения**

Отсутствуют.